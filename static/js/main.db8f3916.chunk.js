(window.webpackJsonpFractals=window.webpackJsonpFractals||[]).push([[0],{230:function(t,e,a){t.exports=a(406)},405:function(t,e,a){},406:function(t,e,a){"use strict";a.r(e);a(231),a(257),a(259),a(260),a(262),a(263),a(264),a(265),a(266),a(267),a(268),a(269),a(271),a(272),a(273),a(274),a(275),a(276),a(277),a(278),a(279),a(280),a(282),a(283),a(284),a(285),a(286),a(287),a(288),a(289),a(290),a(291),a(292),a(293),a(294),a(295),a(296),a(297),a(298),a(299);var n=a(0),o=a.n(n),r=a(54),i=a.n(r),c=a(35),l=a.n(c),s=a(55),u=a(68),h=a(66),d=a(67),v=a(138),m=a(129),p=a(47),f=a(139),y=a(136),w=a(29),b=function(){function t(e,a,n,o){var r=a.x,i=a.y,c=a.r;Object(h.a)(this,t),this.canvas=e,this.ctx=e.getContext("2d"),this.maxIterations=n,this.getColor=o,this.scaleData={x:r,y:i,r:c}}return Object(d.a)(t,[{key:"getScalePos",value:function(t){var e=t.x,a=t.y,n=this.canvas,o=n.width,r=n.height,i=this.scaleData,c=i.r,l=r/o;return{x:(e*c/o-c/2+i.x*l)/l,y:-1*(a*c/r-c/2)+i.y}}},{key:"getIndexPos",value:function(t){var e=this.canvas;return t/=4,this.getScalePos({x:t%e.width,y:Math.floor(t/e.width)})}},{key:"isMandlebrot",value:function(t){var e,a=t.x,n=t.y,o=a,r=n;for(e=0;e<this.maxIterations;e++){if(Math.pow(o,2)+Math.pow(r,2)>4)return[!1,e,o,r];var i=o*r*2+n;o=Math.pow(o,2)-Math.pow(r,2)+a,r=i}return[!0,e,o,r]}},{key:"draw",value:function(){for(var t=this.canvas,e=t.width,a=t.height,n=this.ctx,o=this.maxIterations,r=n.createImageData(e,a),i=r.data.length,c=0;c<i;c+=4){var l=this.getIndexPos(c),u=this.isMandlebrot(l,2),h=Object(s.a)(u,4),d=(h[0],h[1]),v=h[2],m=h[3],p=this.getColor(o,d,m,v),f=Object(s.a)(p,4),y=f[0],w=f[1],b=f[2],g=f[3];r.data[c]=y,r.data[c+1]=w,r.data[c+2]=b,r.data[c+3]=g}n.putImageData(r,0,0)}}]),t}(),g=a(91),I=a.n(g),S=a(130),z=a.n(S),x=a(131),C=a.n(x),E=a(132),M=a.n(E),k=a(133),D=a.n(k),O=(a(404),a(405),a(137)),P=function(t){function e(t){var a;Object(h.a)(this,e),(a=Object(v.a)(this,Object(m.a)(e).call(this,t))).onTick=function(){var t=a.state.quality+1;t>3||a.state.ttl>Date.now()?setTimeout(a.onTick,500):(a.setState({quality:t}),a.updateCanvas(),requestAnimationFrame((function(){setTimeout(a.onTick,500)})))},a.onWheel=function(t){var e=a.state,n=e.location,o=e.zoom,r=n.r/1e3;return t.altKey||t.ctrlKey?(o-=t.deltaY/(100/o),o=Math.max(1,o),n.r=1/o):(n.x+=t.deltaX*r,n.y-=t.deltaY*r),a.setState({location:Object(u.a)({},n),zoom:o,quality:0,ttl:Date.now()+2e3}),a.updateCanvas(),t.cancelBubble=1,t.preventDefault(),t.stopImmediatePropagation(),!1},a.toggleScalePointer=function(t){if("Alt"===t.key){var e="keydown"===t.type?"block":"none";a.setState({scalePointerDisplay:e})}},a.onTouchMove=function(t){if("mousemove"!==t.type||a.mouseButton){var e=a.state,n=e.location,o=(e.zoom,n.r/750),r=t.touches?t.touches[0]:t,i=r.clientX,c=r.clientY,l=Object(p.a)(a),s=l.prevX,h=void 0===s?i:s,d=l.prevY,v=i-h,m=c-(void 0===d?c:d);if(a.prevX=i,a.prevY=c,"mousedown"===t.type)a.mouseButton=1;else{if("touchstart"===t.type)return;n.x-=v*o,n.y+=m*o}return a.setState({location:Object(u.a)({},n),quality:0,ttl:Date.now()+2e3}),t.cancelBubble=1,t.preventDefault(),t.stopImmediatePropagation(),a.updateCanvas(),!1}},a.updateCanvas=function(){var t=Object(p.a)(a),e=t.canvas.current,n=t.state,o=n.location,r=n.colorIndex,i=o.x,c=o.y,s=o.r,u=-250*Math.log(s)+100,h=I.a[r];new b(e,o,u,h).draw();var d=[i,c,s,r].join("/");window.location.hash=d,l.a.send("VKWebAppSetLocation",{location:d})},a.onResize=function(t,e){a.setState({width:t,height:e,quality:0}),a.updateCanvas()},a.nextColor=function(){var t=(a.state.colorIndex+1)%I.a.length;a.setState({colorIndex:t,quality:0})},a.downloadFile=function(t,e){if(l.a.supports("VKWebAppDownloadFile"))l.a.send("VKWebAppDownloadFile",{url:t,filename:e});else{var a=document.createElement("a");a.href=t,a.download=e,a.target="_blank",a.style.display="none",document.body.appendChild(a),a.click(),a.outerHTML=""}},a.shareSave=function(){var t=Object(p.a)(a),e=t.canvas.current,n=t.state,o=n.location,r=(n.colorIndex,o.x),i=o.y;o.r;a.downloadFile(e.toDataURL(),"".concat(r,"-").concat(i,".png"))},a.shareStory=function(){var t=Object(p.a)(a).canvas.current;l.a.send("VKWebAppShowStoryBox",{background_type:"image",blob:t.toDataURL(),attachment:{text:"watch",type:"url",url:"https://vk.com/app7511231"+window.location.hash}})},a.share=function(){a.setState({popout:o.a.createElement(w.ActionSheet,{onClose:function(){return a.setState({popout:null})}},l.a.supports("VKWebAppDownloadFile")?o.a.createElement(w.ActionSheetItem,{autoclose:!0,onClick:a.shareStory},"\u0418\u0441\u0442\u043e\u0440\u0438\u044e"):"",o.a.createElement(w.ActionSheetItem,{autoclose:!0,onClick:a.shareSave},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432 \u0444\u0430\u0439\u043b"),O.a&&o.a.createElement(w.ActionSheetItem,{autoclose:!0,mode:"cancel"},"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c"))})},a.zoomChange=function(t){var e=a.state,n=e.location,o=e.zoom;return o+=t/(100/o),console.log(o),o=Math.max(1,o),console.log(o),n.r=1/o,a.setState({location:Object(u.a)({},n),zoom:o,quality:0,ttl:Date.now()+2e3}),a.updateCanvas(),!1},a.zoomOut=function(){return a.zoomChange(-10)},a.zoomIn=function(){return a.zoomChange(100)},a.zoomOutStart=function(){return a.zoomIntervalChange(-10)},a.zoomInStart=function(){return a.zoomIntervalChange(100)},a.zoomIntervalChange=function(t){a.zoomInterval&&clearInterval(a.zoomInterval),a.zoomInterval=setInterval(a.zoomChange,250,t)},a.zoomIntervalReset=function(){a.mouseButton=0,a.zoomInterval&&clearInterval(a.zoomInterval)};var n=-1.25,r=0,i=1,c=4;if(/^#[-.\de,/]+$/.test(window.location.hash)){var d=window.location.hash.substr(1).split("/").map((function(t){return parseFloat(t)})),f=Object(s.a)(d,4);n=f[0],r=f[1],i=f[2],c=f[3]}return a.canvas=o.a.createRef(),a.state={activePanel:"CanvasScreen",ttl:Date.now(),quality:0,zoom:1/i,width:100,height:100,colorIndex:c||4,scalePointerDisplay:"none",location:{x:n,y:r,r:i}},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"componentDidMount",value:function(){var t=this.canvas.current;l.a.send("VKWebAppSetViewSettings",{status_bar_style:"light",action_bar_color:"none"}),t.addEventListener("touchstart",this.onTouchMove,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove,{passive:!1}),t.addEventListener("mousedown",this.onTouchMove,{passive:!1}),t.addEventListener("mousemove",this.onTouchMove,{passive:!1}),document.body.addEventListener("wheel",this.onWheel,{passive:!1}),document.body.addEventListener("keydown",this.toggleScalePointer),document.body.addEventListener("keyup",this.toggleScalePointer),document.body.addEventListener("mouseup",this.zoomIntervalReset),document.body.addEventListener("touchend",this.zoomIntervalReset),document.body.addEventListener("blur",this.zoomIntervalReset),this.onTick()}},{key:"render",value:function(){var t=this.canvas,e=(this.props.id,this.state),a=e.width,n=e.height,r=e.quality,i=e.zoom,c=e.location,l=c.x,s=c.y,u=c.r,h=e.scalePointerDisplay,d="".concat(1*l.toFixed(10)," ").concat(1*s.toFixed(10)),v=[.05,.5,1,2][r];return o.a.createElement(w.ConfigProvider,null,o.a.createElement(w.View,{activePanel:"CanvasScreen",popout:this.state.popout},o.a.createElement(w.Panel,{id:"CanvasScreen"},o.a.createElement(w.PanelHeader,{left:o.a.createElement(w.PanelHeaderButton,{onClick:this.share},o.a.createElement(z.a,null)),children:o.a.createElement(w.PanelHeaderContent,{status:d,children:"Mandelbrot set"}),transparent:!0,separator:!1}),o.a.createElement(y.a,{handleWidth:!0,handleHeight:!0,onResize:this.onResize}),o.a.createElement("canvas",{id:"canvas",ref:t,width:a*v,height:n*v}),o.a.createElement("div",{id:"pointer",style:{display:h}}),o.a.createElement("div",{id:"location"},"r".concat(u," z").concat(i," q").concat(r)),o.a.createElement("div",{id:"controls"},o.a.createElement(w.CellButton,{onClick:this.nextColor},o.a.createElement(C.a,null)),o.a.createElement(w.CellButton,{onClick:this.zoomIn,onMouseDown:this.zoomInStart,onTouchStart:this.zoomInStart,children:o.a.createElement(M.a,null)}),o.a.createElement(w.CellButton,{onClick:this.zoomOut,onMouseDown:this.zoomOutStart,onTouchStart:this.zoomOutStart,children:o.a.createElement(D.a,null)})))))}}]),e}(n.Component);l.a.send("VKWebAppInit"),i.a.render(o.a.createElement(P,null),document.getElementById("root"))},91:function(t,e){function a(t,e,a){a>1&&(a=1);var n=t/60,o=a*e,r=o*(1-Math.abs(n%2-1)),i=[0,0,0];0<=n&&n<1&&(i=[o,r,0]),1<=n&&n<2&&(i=[r,o,0]),2<=n&&n<3&&(i=[0,o,r]),3<=n&&n<4&&(i=[0,r,o]),4<=n&&n<5&&(i=[r,0,o]),5<=n&&n<6&&(i=[o,0,r]);var c=a-o;return i[0]+=c,i[1]+=c,i[2]+=c,i[0]*=255,i[1]*=255,i[2]*=255,i}var n=1/Math.log(2),o=(Math.log(.5),[0,0,0,255]);function r(t,e,a,n){var o=1/Math.log(2);return 5+e-Math.log(.5)*o-Math.log(Math.log(e))*o}function i(t,e,a,n){if(e==t)return o;var i=r(0,e);return(i=Math.floor(512*i/t))>255&&(i=255),[i,i,i,255]}t.exports=[i,function(t,e,a,n){if(e==t){var o=255-Math.floor(255*Math.sqrt(a+n))%255;return o<0&&(o=0),o>255&&(o=255),[o,o,o,255]}return i(t,e)},function(t,e,n,i){if(e==t)return o;var c=a(360*r(0,e)/t,1,1);return c.push(255),c},function(t,e,n,i){if(e==t)return o;var c=r(0,e),l=a(360*c/t,1,10*c/t);return l.push(255),l},function(t,e,n,i){if(e==t)return o;var c=r(0,e),l=a(360*c/t,1,10*c/t),s=l[0];return l[0]=l[2],l[2]=s,l.push(255),l}]}},[[230,1,2]]]);
//# sourceMappingURL=main.db8f3916.chunk.js.map