{"version":3,"sources":["fractals/Fractal.js","App.js","index.js","fractals/Colors.js"],"names":["Mandelbrot","canvas","maxIterations","getColor","x","y","r","this","ctx","getContext","scaleData","sX","sY","width","height","aspectRatio","index","getScalePos","Math","floor","N","Xo","Yo","Xn","Yn","Yni","imageData","createImageData","imageDataSize","data","length","i","pos","getIndexPos","isMandlebrot","R","G","B","A","putImageData","App","props","onTick","quality","state","ttl","Date","now","setTimeout","setState","updateCanvas","requestAnimationFrame","onWheel","event","location","zoom","step","altKey","ctrlKey","deltaY","max","deltaX","cancelBubble","preventDefault","stopImmediatePropagation","toggleScalePointer","key","scalePointerDisplay","type","onTouchMove","mouseButton","touches","clientX","clientY","prevX","prevY","current","colorIndex","log","colorFnArray","Fractal","draw","hash","join","window","bridge","send","onResize","nextColor","newColorIndex","downloadFile","url","filename","supports","link","document","createElement","href","download","target","style","display","body","appendChild","click","outerHTML","shareSave","toDataURL","shareStory","background_type","blob","attachment","text","share","popout","onClose","autoclose","onClick","IS_PLATFORM_IOS","mode","zoomChange","value","console","zoomOut","zoomIn","zoomOutStart","zoomIntervalChange","zoomInStart","zoomInterval","clearInterval","setInterval","zoomIntervalReset","test","substr","split","map","parseFloat","React","createRef","activePanel","addEventListener","passive","id","locationText","toFixed","scale","left","children","status","transparent","separator","handleWidth","handleHeight","ref","onMouseDown","onTouchStart","Component","ReactDOM","render","getElementById","hsv_to_rgb","h","s","v","hp","c","abs","rgb","m","logBase","interiorColor","smoothColor","steps","n","Tr","Ti","pickColorGrayscale","module","exports","sqrt","push","t"],"mappings":"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","file":"static/js/main.db8f3916.chunk.js","sourcesContent":["\nexport default class Mandelbrot {\n  constructor(canvas, { x, y, r }, maxIterations, getColor) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext(\"2d\");\n\n    this.maxIterations = maxIterations;\n    this.getColor = getColor;\n    this.scaleData = { x, y, r };\n  }\n\n  getScalePos({ x: sX, y: sY }) {\n    const { canvas: { width, height }, scaleData: { r, x, y } } = this;\n    const aspectRatio = height / width;\n\n    return {\n      x: (((sX * r / width) - r / 2) + (x * aspectRatio)) / aspectRatio,\n      y: ((((sY * r / height) - r / 2) * -1) + y),\n    };\n  }\n\n  getIndexPos(index) {\n    const { canvas } = this;\n\n    index /= 4;\n    return  this.getScalePos({\n      x: index % canvas.width,\n      y: Math.floor(index / canvas.width)\n    });\n  }\n\n  isMandlebrot({ x: Xo, y: Yo }) {\n    let Xn = Xo;\n    let Yn = Yo;\n    let N;\n\n    for (N = 0; N < this.maxIterations; N++) {\n      if (Xn**2 + Yn**2 > 4) {\n        return [false, N, Xn, Yn];\n      }\n\n      const Xni = Xn**2 - Yn**2 + Xo;\n      const Yni = (2 * (Xn * Yn)) + Yo;\n\n      Xn = Xni;\n      Yn = Yni;\n    }\n\n    return [true, N, Xn, Yn];\n  }\n\n  draw() {\n    const { canvas: { width, height }, ctx, maxIterations } = this;\n    const imageData = ctx.createImageData(width, height);\n    const imageDataSize = imageData.data.length; // width * height * rgba\n\n    for (let i = 0; i < imageDataSize; i += 4) {\n      let pos = this.getIndexPos(i);\n      const [isBlack, N, Xn, Yn] = this.isMandlebrot(pos, 2);\n      const [R, G, B, A] = this.getColor(maxIterations, N, Yn, Xn);\n\n      imageData.data[i]     = R;\n      imageData.data[i + 1] = G;\n      imageData.data[i + 2] = B;\n      imageData.data[i + 3] = A;\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }\n}\n","import React, { Component } from 'react';\nimport ReactResizeDetector from \"react-resize-detector\";\nimport {\n\tConfigProvider, View, Panel, PanelHeaderContent,\n\tPanelHeader, PanelHeaderButton, CellButton,\n\tActionSheet, ActionSheetItem,\n} from '@vkontakte/vkui/dist/';\nimport Fractal from \"./fractals/Fractal\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport colorFnArray from './fractals/Colors';\n\nimport Icon28ShareExternalOutline from '@vkontakte/icons/dist/28/share_external_outline';\n\nimport Icon28MagicWandOutline from '@vkontakte/icons/dist/28/magic_wand_outline';\nimport Icon28AddCircleOutline from '@vkontakte/icons/dist/28/add_circle_outline';\nimport Icon28RemoveCircleOutline from '@vkontakte/icons/dist/28/remove_circle_outline';\n\nimport '@vkontakte/vkui/dist/vkui.css';\nimport './App.css';\nimport { IS_PLATFORM_IOS } from \"@vkontakte/vkui\";\n\nclass App extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tlet [x, y, r, colorIndex] = [-1.25, 0, 1, 4];\n\t\tif (/^#[-.\\de,/]+$/.test(window.location.hash)) {\n\t\t\t[x, y, r, colorIndex] = window.location.hash.substr(1).split('/').map(x => parseFloat(x));\n\t\t}\n\n\t\tthis.canvas = React.createRef();\n\t\tthis.state = {\n\t\t\tactivePanel: 'CanvasScreen',\n\t\t\tttl: Date.now(),\n\t\t\tquality: 0,\n\t\t\tzoom: 1 / r,\n\t\t\twidth: 100,\n\t\t\theight: 100,\n\t\t\tcolorIndex: colorIndex || 4,\n\t\t\tscalePointerDisplay: 'none',\n\t\t\tlocation: { x, y, r },\n\t\t};\n\t}\n\n\n\tonTick = () => {\n\t\tconst quality = this.state.quality + 1;\n\n\t\tif (quality > 3 || this.state.ttl > Date.now()) {\n\t\t\tsetTimeout(this.onTick, 500);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState({ quality });\n\t\tthis.updateCanvas();\n\t\trequestAnimationFrame(() => {\n\t\t\tsetTimeout(this.onTick, 500);\n\t\t});\n\t};\n\n\tonWheel = (event) => {\n\t\tlet { location, zoom } = this.state;\n\t\tconst step = location.r / 1000;\n\n\t\tif (event.altKey || event.ctrlKey) {\n\t\t\tzoom -= (event.deltaY / (100 / zoom));\n\t\t\tzoom = Math.max(1, zoom);\n\t\t\tlocation.r = 1 / zoom;\n\t\t} else {\n\t\t\tlocation.x += event.deltaX * step;\n\t\t\tlocation.y -= event.deltaY * step;\n\t\t}\n\n\t\tthis.setState({\n\t\t\tlocation: { ...location },\n\t\t\tzoom: zoom,\n\t\t\tquality: 0,\n\t\t\tttl: Date.now() + 2000,\n\t\t});\n\t\tthis.updateCanvas();\n\n\t\tevent.cancelBubble = 1;\n\t\tevent.preventDefault();\n\t\tevent.stopImmediatePropagation();\n\t\treturn false;\n\t};\n\n\ttoggleScalePointer = (event) => {\n\t\tif (event.key !== 'Alt') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst scalePointerDisplay = event.type === 'keydown' ? 'block' : 'none';\n\t\tthis.setState({ scalePointerDisplay })\n\t};\n\n\tonTouchMove = (event) => {\n\t\tif (event.type === 'mousemove' && !this.mouseButton) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet { location, zoom } = this.state;\n\t\tconst step = location.r / 750;\n\n\t\tlet { clientX, clientY } = event.touches ? event.touches[0] : event;\n\t\tlet { prevX=clientX, prevY=clientY } = this;\n\n\t\tconst deltaX = clientX - prevX;\n\t\tconst deltaY = clientY - prevY;\n\n\t\tthis.prevX = clientX;\n\t\tthis.prevY = clientY;\n\n\t\tif (event.type === 'mousedown') {\n\t\t\tthis.mouseButton = 1;\n\t\t} else if (event.type === 'touchstart') {\n\t\t\treturn;\n\t\t} else {\n\t\t\tlocation.x -= deltaX * step;\n\t\t\tlocation.y += deltaY * step;\n\t\t}\n\n\t\tthis.setState({\n\t\t\tlocation: { ...location },\n\t\t\tquality: 0,\n\t\t\tttl: Date.now() + 2000,\n\t\t});\n\n\n\t\tevent.cancelBubble = 1;\n\t\tevent.preventDefault();\n\t\tevent.stopImmediatePropagation();\n\n\t\tthis.updateCanvas();\n\t\treturn false;\n\t};\n\n\tcomponentDidMount() {\n\t\tconst { canvas: { current } } = this;\n\n\t\tbridge.send(\"VKWebAppSetViewSettings\", {\n\t\t\t\"status_bar_style\": \"light\",\n\t\t\t\"action_bar_color\": \"none\"\n\t\t});\n\n\t\tcurrent.addEventListener('touchstart', this.onTouchMove, {passive: false});\n\t\tcurrent.addEventListener('touchmove', this.onTouchMove, {passive: false});\n\t\tcurrent.addEventListener('mousedown', this.onTouchMove, {passive: false});\n\t\tcurrent.addEventListener('mousemove', this.onTouchMove, {passive: false});\n\n\t\tdocument.body.addEventListener('wheel', this.onWheel, {passive: false});\n\t\tdocument.body.addEventListener('keydown', this.toggleScalePointer);\n\t\tdocument.body.addEventListener('keyup', this.toggleScalePointer);\n\n\t\tdocument.body.addEventListener('mouseup', this.zoomIntervalReset);\n\t\tdocument.body.addEventListener('touchend', this.zoomIntervalReset);\n\t\tdocument.body.addEventListener('blur', this.zoomIntervalReset);\n\t\tthis.onTick();\n\t}\n\n\tupdateCanvas = () => {\n\t\tconst { canvas: { current }, state: { location, colorIndex } } = this;\n\t\tconst { x, y, r } = location;\n\t\tconst maxIterations = -250 * Math.log(r) + 100;\n\t\tconst getColor = colorFnArray[colorIndex];\n\n\t\tnew Fractal(current, location, maxIterations, getColor).draw();\n\n\t\tconst hash = [x, y, r, colorIndex].join('/');\n\t\twindow.location.hash = hash;\n\t\tbridge.send(\"VKWebAppSetLocation\", {\n\t\t\tlocation: hash\n\t\t});\n\t};\n\n\tonResize = (width, height) => {\n\t\tthis.setState({ width, height, quality: 0 });\n\t\tthis.updateCanvas();\n\t};\n\n\tnextColor = () => {\n\t\tconst { colorIndex } = this.state;\n\t\tconst newColorIndex = (colorIndex + 1) % colorFnArray.length;\n\n\t\tthis.setState({\n\t\t\tcolorIndex: newColorIndex,\n\t\t\tquality: 0,\n\t\t})\n\t};\n\n\tdownloadFile = (url, filename) => {\n    if (bridge.supports(\"VKWebAppDownloadFile\")) {\n\t\t\tbridge.send(\"VKWebAppDownloadFile\", {\n\t\t\t\t\"url\": url,\n\t\t\t\t\"filename\": filename,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n    const link = document.createElement('a');\n\t\tlink.href = url;\n\t\tlink.download = filename;\n\t\tlink.target = '_blank';\n\t\tlink.style.display = 'none';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tlink.outerHTML = '';\n\t};\n\n\tshareSave = () => {\n\t\tconst { canvas: { current }, state: { location, colorIndex } } = this;\n\t\tconst { x, y, r } = location;\n\n\t\tthis.downloadFile(current.toDataURL(), `${x}-${y}.png`);\n\t};\n\n\tshareStory = () => {\n\t\tconst { canvas: { current } } = this;\n\n\t\tbridge.send(\"VKWebAppShowStoryBox\", {\n\t\t\tbackground_type : \"image\",\n\t\t\tblob: current.toDataURL(),\n\t\t\tattachment: {\n\t\t\t\ttext: 'watch',\n\t\t\t\ttype: 'url',\n\t\t\t\turl: 'https://vk.com/app7511231' + window.location.hash\n\t\t\t}\n\t\t});\n\t};\n\n\tshare = () => {\n\t\tthis.setState({ popout:\n\t\t\t\t<ActionSheet onClose={() => this.setState({ popout: null })}>\n\t\t\t\t\t{!bridge.supports(\"VKWebAppDownloadFile\") ? '' : (\n\t\t\t\t\t\t<ActionSheetItem autoclose onClick={this.shareStory}>\n\t\t\t\t\t\t\tИсторию\n\t\t\t\t\t\t</ActionSheetItem>\n\t\t\t\t\t)}\n\t\t\t\t\t<ActionSheetItem autoclose  onClick={this.shareSave}>\n\t\t\t\t\t\tСохранить в файл\n\t\t\t\t\t</ActionSheetItem>\n\t\t\t\t\t{IS_PLATFORM_IOS && <ActionSheetItem autoclose mode=\"cancel\">Отменить</ActionSheetItem>}\n\t\t\t\t</ActionSheet>\n\t\t});\n\t};\n\n\tzoomChange = (value) => {\n\t\tlet { location, zoom } = this.state;\n\n\t\tzoom += (value / (100 / zoom));\n\t\tconsole.log(zoom);\n\t\tzoom = Math.max(1, zoom);\n\t\tconsole.log(zoom);\n\t\tlocation.r = 1 / zoom;\n\n\t\tthis.setState({\n\t\t\tlocation: { ...location },\n\t\t\tzoom: zoom,\n\t\t\tquality: 0,\n\t\t\tttl: Date.now() + 2000,\n\t\t});\n\n\t\tthis.updateCanvas();\n\t\treturn false;\n\t};\n\n\tzoomOut = () => this.zoomChange(-10);\n\tzoomIn = () => this.zoomChange(100);\n\tzoomOutStart = () => this.zoomIntervalChange(-10);\n\tzoomInStart = () => this.zoomIntervalChange(100);\n\n\tzoomIntervalChange = (value) => {\n\t\tif (this.zoomInterval) {\n\t\t\tclearInterval(this.zoomInterval);\n\t\t}\n\n\t\tthis.zoomInterval = setInterval(this.zoomChange, 250, value);\n\t};\n\n\tzoomIntervalReset = () => {\n\t\tthis.mouseButton = 0;\n\t\tif (this.zoomInterval) {\n\t\t\tclearInterval(this.zoomInterval);\n\t\t}\n\t};\n\n\trender() {\n\t\tconst { canvas } = this;\n\t\tconst { id } = this.props;\n\t\tconst { width, height, quality, zoom, location: { x, y, r }, scalePointerDisplay } = this.state;\n\t\tconst locationText = `${x.toFixed(10) * 1} ${y.toFixed(10) * 1}`;\n\t\tconst scale = [0.05, 0.5, 1, 2][quality];\n\n\t\treturn (\n\t\t\t<ConfigProvider>\n\t\t\t\t<View activePanel='CanvasScreen' popout={this.state.popout}>\n\t\t\t\t\t<Panel id='CanvasScreen'>\n\t\t\t\t\t\t<PanelHeader\n\t\t\t\t\t\t\tleft={<PanelHeaderButton onClick={this.share}><Icon28ShareExternalOutline/></PanelHeaderButton>}\n\t\t\t\t\t\t\tchildren={\n\t\t\t\t\t\t\t\t<PanelHeaderContent\n\t\t\t\t\t\t\t\t\tstatus={locationText}\n\t\t\t\t\t\t\t\t\tchildren={'Mandelbrot set'}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttransparent={true}\n\t\t\t\t\t\t\tseparator={false}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ReactResizeDetector\n\t\t\t\t\t\t\thandleWidth handleHeight\n\t\t\t\t\t\t\tonResize={this.onResize}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<canvas id='canvas' ref={canvas} width={width * scale} height={height * scale}/>\n\t\t\t\t\t\t<div id='pointer' style={{ display: scalePointerDisplay }} />\n\t\t\t\t\t\t<div id='location'>{`r${r} z${zoom} q${quality}`}</div>\n\t\t\t\t\t\t<div id='controls'>\n\t\t\t\t\t\t\t<CellButton onClick={this.nextColor}><Icon28MagicWandOutline /></CellButton>\n\t\t\t\t\t\t\t<CellButton\n\t\t\t\t\t\t\t\tonClick={this.zoomIn}\n\t\t\t\t\t\t\t\tonMouseDown={this.zoomInStart}\n\t\t\t\t\t\t\t\tonTouchStart={this.zoomInStart}\n\t\t\t\t\t\t\t\tchildren={<Icon28AddCircleOutline />}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<CellButton\n\t\t\t\t\t\t\t\tonClick={this.zoomOut}\n\t\t\t\t\t\t\t\tonMouseDown={this.zoomOutStart}\n\t\t\t\t\t\t\t\tonTouchStart={this.zoomOutStart}\n\t\t\t\t\t\t\t\tchildren={<Icon28RemoveCircleOutline />}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Panel>\n\t\t\t\t</View>\n\t\t\t</ConfigProvider>\n\t\t);\n\t}\n}\n\nexport default App;\n\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n","/*\n * Convert hue-saturation-value/luminosity to RGB.\n *\n * Input ranges:\n *   H =   [0, 360] (integer degrees)\n *   S = [0.0, 1.0] (float)\n *   V = [0.0, 1.0] (float)\n */\nfunction hsv_to_rgb(h, s, v) {\n  if (v > 1.0) v = 1.0;\n  var hp = h / 60.0;\n  var c = v * s;\n  var x = c * (1 - Math.abs((hp % 2) - 1));\n  var rgb = [0, 0, 0];\n\n  if (0 <= hp && hp < 1) rgb = [c, x, 0];\n  if (1 <= hp && hp < 2) rgb = [x, c, 0];\n  if (2 <= hp && hp < 3) rgb = [0, c, x];\n  if (3 <= hp && hp < 4) rgb = [0, x, c];\n  if (4 <= hp && hp < 5) rgb = [x, 0, c];\n  if (5 <= hp && hp < 6) rgb = [c, 0, x];\n\n  var m = v - c;\n  rgb[0] += m;\n  rgb[1] += m;\n  rgb[2] += m;\n\n  rgb[0] *= 255;\n  rgb[1] *= 255;\n  rgb[2] *= 255;\n  return rgb;\n}\n\n// Some constants used with smoothColor\nvar logBase = 1.0 / Math.log(2.0);\nvar logHalfBase = Math.log(0.5) * logBase;\nvar interiorColor = [0, 0, 0, 255];\n\nfunction smoothColor(steps, n, Tr, Ti) {\n  var logBase = 1.0 / Math.log(2.0);\n  var logHalfBase = Math.log(0.5) * logBase;\n  /*\n   * Original smoothing equation is\n   *\n   * var v = 1 + n - Math.log(Math.log(Math.sqrt(Zr*Zr+Zi*Zi)))/Math.log(2.0);\n   *\n   * but can be simplified using some elementary logarithm rules to\n   */\n  return 5 + n - logHalfBase - Math.log(Math.log(n)) * logBase;\n}\n\nfunction pickColorHSV1(steps, n, Tr, Ti) {\n  if (n == steps) // converged?\n    return interiorColor;\n\n  var v = smoothColor(steps, n, Tr, Ti);\n  var c = hsv_to_rgb(360.0 * v / steps, 1.0, 1.0);\n  c.push(255); // alpha\n  return c;\n}\n\nfunction pickColorHSV2(steps, n, Tr, Ti) {\n  if (n == steps) // converged?\n    return interiorColor;\n\n  var v = smoothColor(steps, n, Tr, Ti);\n  var c = hsv_to_rgb(360.0 * v / steps, 1.0, 10.0 * v / steps);\n  c.push(255); // alpha\n  return c;\n}\n\nfunction pickColorHSV3(steps, n, Tr, Ti) {\n  if (n == steps) // converged?\n    return interiorColor;\n\n  var v = smoothColor(steps, n, Tr, Ti);\n  var c = hsv_to_rgb(360.0 * v / steps, 1.0, 10.0 * v / steps);\n\n  // swap red and blue\n  var t = c[0];\n  c[0] = c[2];\n  c[2] = t;\n\n  c.push(255); // alpha\n  return c;\n}\n\nfunction pickColorGrayscale(steps, n, Tr, Ti) {\n  if (n == steps) // converged?\n    return interiorColor;\n\n  var v = smoothColor(steps, n, Tr, Ti);\n  v = Math.floor(512.0 * v / steps);\n  if (v > 255) v = 255;\n  return [v, v, v, 255];\n}\n\nfunction pickColorGrayscale2(steps, n, Tr, Ti) {\n  if (n == steps) { // converged?\n    var c = 255 - Math.floor(255.0 * Math.sqrt(Tr + Ti)) % 255;\n    if (c < 0) c = 0;\n    if (c > 255) c = 255;\n    return [c, c, c, 255];\n  }\n\n  return pickColorGrayscale(steps, n, Tr, Ti);\n}\n\nmodule.exports = ([\n  pickColorGrayscale,\n  pickColorGrayscale2,\n  pickColorHSV1,\n  pickColorHSV2,\n  pickColorHSV3,\n]);\n"],"sourceRoot":""}